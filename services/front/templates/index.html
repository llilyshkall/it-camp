<!doctype html>
<html lang="ru" data-theme="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a73b7" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="–ì–∞–∑–ø—Ä–æ–º –ü—Ä–æ–µ–∫—Ç" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <title>{{ page_title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='mobile-specific.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='pumpjack.css') }}">
</head>
<body>
<a class="skip-link" href="#main">–ö —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é</a>

<header>
  <div class="header-top">
    <div class="container">
      <div class="brand">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</div>
      <nav class="meta-nav" aria-label="–°–ª—É–∂–µ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <button id="theme-toggle" class="icon-btn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
        <a href="#top">–ü–æ–º–æ—â—å</a>
        <a href="#top" lang="ru">RU</a>
      </nav>
    </div>
  </div>

  <div class="main-nav-wrapper">
    <div class="container header-row">
      <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å–ª–µ–≤–∞ -->
      <div class="left-nav">
        <button class="nav-toggle btn btn-ghost" id="nav-toggle" aria-haspopup="true" aria-expanded="false" title="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏">
          <span class="nav-toggle-icon" aria-hidden="true">‚ò∞</span>
        </button>
        <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="nav-dropdown" id="nav-dropdown" hidden>
          <ul class="nav-menu" id="nav-menu" role="menu">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –≤–∫–ª–∞–¥–∫–∏ -->
            <li class="nav-menu-item active">
              <a href="#assurance-card" class="nav-menu-link" data-target="#assurance-card">
                <span class="nav-menu-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—à—É—Ä–µ–Ω—Å–∞</span>
              </a>
            </li>
            <li class="nav-menu-item active">
              <a href="/dashboards" class="nav-menu-link">
                <span class="nav-menu-text">–î–∞—à–±–æ—Ä–¥—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º</span>
              </a>
            </li>

            <li class="nav-menu-item inactive">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Å–∫–æ—Ä–æ)</span>
              </a>
            </li>
            
            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
            <li class="nav-menu-separator"></li>
            
            <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ) -->
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ù–æ–≤–æ—Å—Ç–∏</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∞—à—É—Ä–∞–Ω—Å—ã</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ü—Ä–æ–µ–∫—Ç—ã</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–Ω–∞–Ω–∏–π</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–í–æ–ø—Ä–æ—Å —ç–∫—Å–ø–µ—Ä—Ç—É</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–¢–µ—Ä–º–∏–Ω—ã</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–§—É–Ω–∫—Ü–∏–∏</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
              </a>
            </li>
            <li class="nav-menu-item system">
              <a href="#" class="nav-menu-link" onclick="return false;">
                <span class="nav-menu-text">–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</span>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="wordmark"><a class="wordmark-link" href="#top">–ü–†–û–ï–ö–¢ –î–õ–Ø –ì–ê–ó–ü–†–û–ú–ê</a></div>

      <div class="project-ctl" aria-label="–í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞">
        <div class="proj-dropdown" id="proj-dropdown">
          <button class="proj-toggle btn btn-outline" id="proj-toggle" aria-haspopup="listbox" aria-expanded="false" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞">
            <span id="proj-current">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</span>
            <span class="proj-toggle-arrow" aria-hidden="true">‚ñº</span>
          </button>
          <ul class="proj-menu" id="proj-menu" role="listbox" tabindex="-1" hidden></ul>
        </div>
        <button class="btn btn-primary" id="add-project-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
      </div>

      <nav class="main-nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <a href="#top" data-target="#top" class="nav-link" aria-current="page">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#assurance-card" data-target="#assurance-card" class="nav-link">–ß–µ–∫-–ª–∏—Å—Ç</a>
        <a href="#remarks-card" data-target="#remarks-card" class="nav-link">–ó–∞–º–µ—á–∞–Ω–∏—è</a>
        <a href="#protocol-card" data-target="#protocol-card" class="nav-link">–ü—Ä–æ—Ç–æ–∫–æ–ª</a>
      </nav>
    </div>
  </div>
</header>

<main id="main">
  <span id="top" class="anchor-offset" aria-hidden="true"></span>

  <!-- HERO —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–æ–π -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <div class="hero-text">
          <h1>–ß–∏—Å—Ç–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>
          <p class="lead">–ó–∞–≥–ª—É—à–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —ç—Å—Ç–µ—Ç–∏–∫–æ–π ¬´—Å–∏–Ω–µ-–±–µ–ª–æ–≥–æ¬ª –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∏–ª—è. –ë–µ–∑ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ –∏ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤. –ì–æ—Ç–æ–≤–æ –∫ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—é.</p>
        </div>
        <div class="hero-visual">
          <!-- –ê–Ω–∏–º–∞—Ü–∏—è Pumpjack -->
          <div class="pumpjack-container" id="hero-pumpjack">
            <div class="pumpjack-canvas-container">
              <canvas id="hero-pumpjack-canvas" width="900" height="600"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- –®–∞–≥–∏ -->
  <section class="steps">
    <div class="container">
      <ol class="steps-grid" aria-label="–≠—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞">
        <li class="step" data-target="#assurance-card">
          <div class="step-num" aria-label="–®–∞–≥ 1">1</div>
          <div class="step-body">
            <div class="step-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É</div>
            <div class="step-desc">–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∞—à—É—Ä–∞–Ω—Å–∞.</div>
          </div>
        </li>
        <li class="step" data-target="#remarks-card">
          <div class="step-num" aria-label="–®–∞–≥ 2">2</div>
          <div class="step-body">
            <div class="step-title">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–º–µ—á–∞–Ω–∏–π</div>
            <div class="step-desc">–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è Excel –∏ –≤—ã–≥—Ä—É–∑–∫–∞.</div>
          </div>
        </li>
        <li class="step" data-target="#protocol-card">
          <div class="step-num" aria-label="–®–∞–≥ 3">3</div>
          <div class="step-body">
            <div class="step-title">–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</div>
            <div class="step-desc">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.</div>
          </div>
        </li>

      </ol>
    </div>
  </section>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <section class="section">
    <div class="container">
      <div class="stack">

        <!-- 1) –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É -->
        <div class="card card-lg" id="assurance-card">
          <div class="card-head">
            <div class="card-icon" aria-hidden="true">‚úÖ</div>
            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É –¥–ª—è –∞—à—É—Ä–∞–Ω—Å–∞</h3>
          </div>
          <p class="sublead">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã. –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã: <strong>PDF, DOC(X), XLS(X), CSV, TXT</strong>. –î–æ <strong>25&nbsp;–ú–ë</strong> —Å—É–º–º–∞—Ä–Ω–æ.</p>

          <div id="dropzone" class="dropzone" aria-label="–ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤" tabindex="0" role="button" aria-pressed="false">
            <input id="file-input" type="file" name="files[]" multiple aria-hidden="true" accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.txt" />
            <div class="dz-in">
              <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</strong>
              <span class="dz-sep">–∏–ª–∏</span>
              <button type="button" id="pick-btn" class="btn btn-ghost">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
            </div>
          </div>

          <div id="upload-info" class="upload-info" hidden></div>

          <div id="assurance-result" class="assurance-result" hidden>
            <span id="verdict-badge" class="badge">‚Äî</span>
            <ul id="verdict-reasons" class="reasons"></ul>
          </div>

          <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–æ–π -->
          <div class="loading-indicator" id="assurance-loading" hidden>
            <div class="oil-rig-container loading" style="height: 120px; margin: 1rem 0;">
              <!-- –ú–∏–Ω–∏-–≤–µ—Ä—Å–∏—è –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
            </div>
            <p class="loading-text">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã...</p>
          </div>

          <div class="actions actions--stacked">
            <button class="btn btn-primary btn-large" id="start-assurance" disabled>
              <span class="btn-icon" aria-hidden="true">üöÄ</span>
              –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>
            <button class="btn btn-outline" id="check-result" disabled>
              <span class="btn-icon" aria-hidden="true">üîç</span>
              –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            </button>
            <button class="btn btn-ghost" id="download-assurance" disabled>
              <span class="btn-icon" aria-hidden="true">üì•</span>
              –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç
            </button>
          </div>
        </div>

        <!-- 2) –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–º–µ—á–∞–Ω–∏–π -->
        <div class="card card-lg" id="remarks-card">
          <div class="card-head">
            <div class="card-icon" aria-hidden="true">üßæ</div>
            <h3>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–º–µ—á–∞–Ω–∏–π</h3>
          </div>
          <p class="sublead">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª—ã —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞ –ø–æ—Å–ª–µ –∞—à—É—Ä–∞–Ω—Å–∞ (<strong>.xls/.xlsx</strong>). –ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º ¬´–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –∑–∞–º–µ—á–∞–Ω–∏–π¬ª –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤.</p>

          <div id="remarks-zone" class="dropzone" aria-label="–§–∞–π–ª –∑–∞–º–µ—á–∞–Ω–∏–π" tabindex="0" role="button" aria-pressed="false">
            <input id="remarks-input" type="file" name="remarks[]" multiple accept=".xls,.xlsx" aria-hidden="true" />
            <div class="dz-in">
              <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Excel —Ñ–∞–π–ª—ã —Å—é–¥–∞</strong>
              <span class="dz-sep">–∏–ª–∏</span>
              <button type="button" id="remarks-pick" class="btn btn-ghost">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
            </div>
          </div>

          <div id="remarks-info" class="upload-info" hidden></div>

          <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–æ–π -->
          <div class="loading-indicator" id="remarks-loading" hidden>
            <div class="oil-rig-container loading" style="height: 120px; margin: 1rem 0;">
              <!-- –ú–∏–Ω–∏-–≤–µ—Ä—Å–∏—è –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
            </div>
            <p class="loading-text">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–º–µ—á–∞–Ω–∏—è...</p>
          </div>

          <div class="actions actions--stacked">
            <button class="btn btn-primary btn-large" id="start-remarks" disabled>
              <span class="btn-icon" aria-hidden="true">‚öôÔ∏è</span>
              –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è
            </button>
            <button class="btn btn-outline" id="download-remarks" disabled>
              <span class="btn-icon" aria-hidden="true">üì•</span>
              –°–∫–∞—á–∞—Ç—å —Ä–µ–µ—Å—Ç—Ä
            </button>
          </div>
        </div>

        <!-- 3) –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ -->
        <div class="card card-lg" id="protocol-card">
          <div class="card-head">
            <div class="card-icon" aria-hidden="true">üìÑ</div>
            <h3>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</h3>
          </div>
          <p class="sublead">–ù–∞–∂–º–∏—Ç–µ ¬´–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å¬ª, –∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç —Ñ–∞–π–ª –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –ü–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª¬ª —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π.</p>
          
          <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–æ–π -->
          <div class="loading-indicator" id="protocol-loading" hidden>
            <div class="oil-rig-container loading" style="height: 120px; margin: 1rem 0;">
              <!-- –ú–∏–Ω–∏-–≤–µ—Ä—Å–∏—è –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
            </div>
            <p class="loading-text">–§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª...</p>
          </div>
          
          <div class="actions">
            <button class="btn btn-primary btn-large" id="make-protocol">
              <span class="btn-icon" aria-hidden="true">üìÑ</span>
              –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª
            </button>
            <button class="btn btn-outline btn-large" id="download-protocol" disabled>
              <span class="btn-icon" aria-hidden="true">‚¨áÔ∏è</span>
              –°–∫–∞—á–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª
            </button>
          </div>
        </div>



      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-main">
        <div class="wordmark-sm">–ü—Ä–æ–µ–∫—Ç –¥–ª—è –ì–∞–∑–ø—Ä–æ–º–∞</div>
        <small>–î–µ–º–æ-—Å—Ç–∏–ª—å –±–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Å–∏–º–≤–æ–ª–∏–∫–∏.</small>
      </div>
      <nav class="footer-nav" aria-label="–í—Ç–æ—Ä–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <a href="#top">–ü–æ–ª–∏—Ç–∏–∫–∞</a>
        <a href="#top">–£—Å–ª–æ–≤–∏—è</a>
        <a href="#top">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>
    </div>
    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –Ω–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞ –≤ —Ñ—É—Ç–µ—Ä–µ -->
    <div class="footer-oil-rig">
      <div class="oil-rig-container" style="height: 80px; opacity: 0.6;">
        <!-- –ú–∏–Ω–∏-–≤–µ—Ä—Å–∏—è –Ω–µ—Ñ—Ç—è–Ω–æ–π –≤—ã—à–∫–∏ -->
      </div>
    </div>
  </div>
</footer>

<!-- Modal: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç -->
<div id="project-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="project-modal-title" hidden>
  <div class="modal-backdrop" data-close="modal"></div>
  <div class="modal-dialog">
    <div class="modal-head">
      <h3 id="project-modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
    </div>
    <div class="modal-body">
      <form id="project-form">
        <label class="field">
          <span class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞<span aria-hidden="true">*</span></span>
          <input type="text" id="project-name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ø–≥–æ–¥–Ω–æ–µ" />
        </label>
        <label class="field">
          <span class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</span>
          <textarea id="project-desc" rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –º–µ—Ç—Ä–∏–∫–∏"></textarea>
        </label>
      </form>
    </div>
    <div class="modal-actions actions">
      <button class="btn btn-outline" id="cancel-project" type="button" data-close="modal">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" id="save-project" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" hidden>
  <div id="toast-msg"></div>
</div>

 <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π -->
 <script src="{{ url_for('static', filename='mobile-enhancements.js') }}"></script>
 <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ Pumpjack -->
 <script src="{{ url_for('static', filename='pumpjack.js') }}"></script>
 <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –º–æ–¥—É–ª–µ–π -->
 <script type="module" src="{{ url_for('static', filename='module-handlers.js') }}"></script>

<script type="module">
  import { endpoints } from '../static/config.js';
  document.addEventListener('DOMContentLoaded', function() {
    // ===== –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (auto ‚Üí light ‚Üí dark) =====
    (function(){
      const root = document.documentElement;
      const btn = document.getElementById('theme-toggle');
      const apply = (mode) => {
        if (!mode) { root.removeAttribute('data-theme'); btn.textContent='üåô'; return; }
        root.setAttribute('data-theme', mode);
        btn.textContent = mode === 'light' ? 'üåû' : 'üåô';
      };
      const saved = localStorage.getItem('theme');
      apply(saved);
      btn.addEventListener('click', () => {
        const current = root.getAttribute('data-theme');
        let next;
        if (!current) next = 'light';
        else if (current === 'light') next = 'dark';
        else next = null;
        if (next) localStorage.setItem('theme', next); else localStorage.removeItem('theme');
        apply(next);
      });
    })();

    // ===== –õ–µ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è =====
    (function(){
      const navToggle = document.getElementById('nav-toggle');
      const navDropdown = document.getElementById('nav-dropdown');
      const navMenu = document.getElementById('nav-menu');

      function openNavMenu() {
        navDropdown.hidden = false;
        navToggle.setAttribute('aria-expanded', 'true');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –º–µ–Ω—é
        adjustMenuPosition();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        requestAnimationFrame(() => {
          navDropdown.classList.add('open');
        });
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
        setTimeout(() => {
          const firstLink = navMenu.querySelector('.nav-menu-link');
          if (firstLink) firstLink.focus();
        }, 100);
      }

      function adjustMenuPosition() {
        const rect = navDropdown.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        
        // –ï—Å–ª–∏ –º–µ–Ω—é –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ª–µ–≤—ã–π –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞
        if (rect.left < 0) {
          navDropdown.style.right = 'auto';
          navDropdown.style.left = '0';
          navDropdown.style.transformOrigin = 'top left';
        } else {
          navDropdown.style.right = '0';
          navDropdown.style.left = 'auto';
          navDropdown.style.transformOrigin = 'top right';
        }
        
        // –ï—Å–ª–∏ –º–µ–Ω—é —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–æ–µ –¥–ª—è —ç–∫—Ä–∞–Ω–∞
        if (rect.width > viewportWidth - 24) {
          navDropdown.style.width = 'calc(100vw - 24px)';
          navDropdown.style.maxWidth = 'calc(100vw - 24px)';
        }
      }

      function closeNavMenu() {
        navDropdown.classList.remove('open');
        navToggle.setAttribute('aria-expanded', 'false');
        
        // –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º
        setTimeout(() => {
          navDropdown.hidden = true;
        }, 300);
        
        //navToggle.focus();
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
      navToggle.addEventListener('click', (e) => {
        e.preventDefault();
        if (navDropdown.hidden) {
          openNavMenu();
        } else {
          closeNavMenu();
        }
      });

      // // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
      // document.addEventListener('click', (e) => {
      //   if (!navToggle.contains(e.target) && !navDropdown.contains(e.target)) {
      //     closeNavMenu();
      //   }
      // });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !navDropdown.hidden) {
          closeNavMenu();
        }
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
      let scrollTimeout;
      document.addEventListener('scroll', () => {
        if (!navDropdown.hidden) {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            closeNavMenu();
          }, 100);
        }
      }, { passive: true });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      window.addEventListener('resize', () => {
        if (!navDropdown.hidden) {
          closeNavMenu();
        } else {
          // –ï—Å–ª–∏ –º–µ–Ω—é –∑–∞–∫—Ä—ã—Ç–æ, –≤—Å–µ —Ä–∞–≤–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
          adjustMenuPosition();
        }
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º –≤ –º–µ–Ω—é
      navMenu.addEventListener('click', (e) => {
        const link = e.target.closest('.nav-menu-link');
        if (link) {
          const target = link.getAttribute('data-target');
          if (target) {
            e.preventDefault();
            closeNavMenu();
            // –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Ü–µ–ª–∏
            const targetElement = document.querySelector(target);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        }
      });
    })();

    // ===== –ü—Ä–æ–µ–∫—Ç—ã: —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –≤—ã–±–æ—Ä, –º–æ–¥–∞–ª–∫–∞ =====
    (function(){
      const STORAGE_KEY = 'projects';
      const SELECTED_KEY = 'currentProjectId';
      const defaults = [
        // { id: 'yagodnoe', name: '–Ø–≥–æ–¥–Ω–æ–µ', description: '' },
        // { id: 'brusnichnoe', name: '–ë—Ä—É—Å–Ω–∏—á–Ω–æ–µ', description: '' },
      ];

      const byId = (id)=>document.getElementById(id);
      const projToggle = byId('proj-toggle');
      const projMenu = byId('proj-menu');
      const projCurrent = byId('proj-current');
      const addBtn = byId('add-project-btn');
      const modal = byId('project-modal');
      const nameInput = byId('project-name');
      const descInput = byId('project-desc');
      const saveBtn = byId('save-project');

      function readProjects(){
        try { const arr = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); return Array.isArray(arr) ? arr : []; } catch { return []; }
      }
      function writeProjects(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
      function ensureDefaults(){ const arr = readProjects(); if(arr.length===0){ writeProjects(defaults); return defaults; } return arr; }
      function getSelectedId(){ return localStorage.getItem(SELECTED_KEY); }
      function setSelectedId(id){ if(id){ localStorage.setItem(SELECTED_KEY, id); } }

      function currentProject(){ const list = readProjects(); const id = getSelectedId(); return list.find(p=>p.id.toString()===id.toString()) || null; }

      function renderMenu(){
        const list = ensureDefaults();
        projMenu.innerHTML = '';
        list.forEach((p, idx)=>{
          const li = document.createElement('li');
          li.className = 'proj-item';
          li.setAttribute('role','option');
          li.setAttribute('data-id', p.id);
          li.tabIndex = -1;
          li.innerHTML = `<span class="proj-dot" aria-hidden="true"></span><span class="proj-name">${p.name}</span>`;
          //console.log(p.id, p)
          li.addEventListener('click', ()=> selectProject(p.id));
          projMenu.appendChild(li);
        });
        const cur = currentProject();
        projCurrent.textContent = cur ? cur.name : '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç';
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏
        if (cur) {
          projToggle.setAttribute('data-has-project', 'true');
        } else {
          projToggle.removeAttribute('data-has-project');
        }
        
        [...projMenu.children].forEach(li=>{
          li.setAttribute('aria-selected', li.getAttribute('data-id') === (cur?.id||''));
        });
      }

      function openMenu(){ projMenu.hidden = false; projToggle.setAttribute('aria-expanded','true'); }
      function closeMenu(){ projMenu.hidden = true; projToggle.setAttribute('aria-expanded','false'); }

      function selectProject(id){
        setSelectedId(id);
        renderMenu();
        closeMenu();
        window.currentProject = currentProject();
        if (window.currentProject) {
          localStorage.setItem(SELECTED_KEY, id);
        }
        //let curid = getSelectedId();
        //console.log(id, curid , localStorage.getItem(curid), window.currentProject);
        toast(`–í—ã–±—Ä–∞–Ω –ø—Ä–æ–µ–∫—Ç: ${window.currentProject?.name||''}`);
      }

      function uidFromName(name){
        return name.toLowerCase().trim().replace(/\s+/g,'-').replace(/[^a-z–∞-—è0-9\-]/gi,'').slice(0,40) || ('proj-' + Math.random().toString(36).slice(2,8));
      }

      function openModal(){ modal.hidden = false; nameInput.value=''; descInput.value=''; nameInput.focus(); }
      function closeModal(){ modal.hidden = true; }

      // function saveProject(){
      //   const name = (nameInput.value||'').trim();
      //   const desc = (descInput.value||'').trim();
      //   if(!name){ nameInput.focus(); nameInput.setAttribute('aria-invalid','true'); toast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞', false); return; }
      //   nameInput.removeAttribute('aria-invalid');
      //   const list = readProjects();
      //   const id = uidFromName(name);
      //   if(list.some(p=>p.id===id)){
      //     toast('–ü—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ –µ—Å—Ç—å', false);
      //     return;
      //   }
      //   const proj = { id, name, description: desc };
      //   list.push(proj);
      //   writeProjects(list);
      //   setSelectedId(id);
      //   renderMenu();
      //   window.currentProject = proj;
      //   toast('–ü—Ä–æ–µ–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
      //   closeModal();
      // }

      async function fetchProjects() {
        try {
          //const response = await fetch('http://127.0.0.1:8081/api/projects'); // –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
          const response = await fetch(endpoints.getProjects, {method:'GET'});
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ data ‚Äî —ç—Ç–æ –º–∞—Å—Å–∏–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
          return data;
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤:', error);
          return []; // –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
        }
      }

      async function getProjects() {
        const projectsFromBackend = await fetchProjects();

        // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
        // –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage:
        //console.log(JSON.stringify(projectsFromBackend));
        //localStorage.setItem(STORAGE_KEY, JSON.stringify(projectsFromBackend));
        writeProjects(projectsFromBackend)
        const aCard = byId('assurance-card');
        const rCard = byId('remarks-card');
        const pCard = byId('protocol-card');
        
        if (projectsFromBackend.length == 0 ) {
           aCard.hidden = true;
           rCard.hidden = true;
           pCard.hidden = true;
        } else {
           aCard.hidden = false;
           rCard.hidden = false;
           pCard.hidden = false;
        }
      }
      //    Init
      
      getProjects();
      renderMenu();
      window.currentProject = currentProject();

      // Dropdown interactions
      projToggle.addEventListener('click', ()=>{ (projMenu.hidden ? openMenu : closeMenu)(); });
      document.addEventListener('click', (e)=>{
        if(!document.getElementById('proj-dropdown').contains(e.target)) closeMenu();
      });
      projToggle.addEventListener('keydown', (e)=>{ if(e.key==='ArrowDown'){ e.preventDefault(); openMenu(); projMenu.querySelector('.proj-item')?.focus(); } });

      // Modal interactions
      addBtn.addEventListener('click', openModal);
      modal.addEventListener('click', (e)=>{ if(e.target?.dataset?.close==='modal') closeModal(); });
      document.getElementById('cancel-project').addEventListener('click', closeModal);
      //saveBtn.addEventListener('click', saveProject);
      saveBtn.addEventListener('click', (e)=>{ 
        window.moduleHandlers.createProject(nameInput.value, descInput.value); 
        closeModal();
      });
      modal.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); if((e.ctrlKey||e.metaKey)&&e.key==='Enter') window.moduleHandlers.createProject(nameInput.value, descInput.value); });

      // Expose helper fetch wrapper for backend wiring
      window.apiFetch = function(url, options){
        const opts = options ? {...options} : {};
        const headers = new Headers(opts.headers || {});
        const proj = window.currentProject || currentProject();
        if(proj){ headers.set('X-Project-Id', proj.id); headers.set('X-Project-Name', encodeURIComponent(proj.name)); }
        opts.headers = headers;
        return fetch(url, opts);
      }
    })();

    // ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Pumpjack –∞–Ω–∏–º–∞—Ü–∏–∏ =====
    (function(){
      const canvas = document.getElementById('hero-pumpjack-canvas');
      
      if (canvas && window.PumpjackAnimation) {
        // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        const pumpjack = new window.PumpjackAnimation(canvas, {
          width: 900,
          height: 600,
          speed: 0.4,
          stroke: 10,
          showPivots: false,
          autoStart: true
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
        window.heroPumpjack = pumpjack;
        
        // –ö–ª–∏–∫ –ø–æ canvas –¥–ª—è –ø–∞—É–∑—ã/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        canvas.addEventListener('click', () => {
          if (pumpjack.running) {
            pumpjack.pause();
          } else {
            pumpjack.start();
          }
        });
        
        console.log('Pumpjack –∞–Ω–∏–º–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤ hero —Å–µ–∫—Ü–∏–∏');
      } else {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Pumpjack –∞–Ω–∏–º–∞—Ü–∏—é');
      }
    })();

         // –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª
     function scrollToTarget(sel){const el=document.querySelector(sel); if(el) el.scrollIntoView({behavior:'smooth',block:'start'});}

    // –°–∂–∞—Ç–∏–µ —à–∞–ø–∫–∏
    document.addEventListener('scroll',()=>{const w=document.querySelector('.main-nav-wrapper'); if(w) w.classList.toggle('compact',window.scrollY>16);},{passive:true});

    // –ú–µ–Ω—é –∏ ¬´–°—Ç—É–ø–µ–Ω–∏¬ª
    document.querySelectorAll('.nav-link').forEach(a=>{
      a.addEventListener('click',(e)=>{e.preventDefault(); scrollToTarget(a.getAttribute('data-target')||a.getAttribute('href'));});
    });
    document.querySelectorAll('.steps .step').forEach(s=>{
      s.addEventListener('click',()=> scrollToTarget(s.getAttribute('data-target')));
    });

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é –∏ —à–∞–≥–∞
    const anchors=['#top','#assurance-card','#remarks-card','#protocol-card'].map(s=>document.querySelector(s)).filter(Boolean);
    const nav=[...document.querySelectorAll('.nav-link')];
    const steps=[...document.querySelectorAll('.steps .step')];
    const isInView=(el)=>{const r=el.getBoundingClientRect(); return r.top<=140 && r.bottom>=140;};
    const updateActive=()=>{
      for(const s of anchors){
        if(isInView(s)){
          const id='#'+(s.id||'top');
          nav.forEach(a=>a.toggleAttribute('aria-current',(a.getAttribute('data-target')===id)||(a.getAttribute('href')===id)));
          steps.forEach(st=>st.classList.toggle('active', st.getAttribute('data-target')===id));
          break;
        }
      }
    };
    updateActive(); document.addEventListener('scroll',()=>requestAnimationFrame(updateActive),{passive:true});

    // –¢–æ—Å—Ç
    function toast(msg, ok=true){
      const el=document.getElementById('toast'); const text=document.getElementById('toast-msg');
      text.textContent=msg; el.classList.toggle('bad', !ok); el.hidden=false; el.classList.add('show');
      setTimeout(()=>el.classList.remove('show'), 2400);
    }

    // ===== 1) –ê—à—É—Ä–µ–Ω—Å =====
    (()=>{const dz=document.getElementById('dropzone'); const input=document.getElementById('file-input');
      const pickBtn=document.getElementById('pick-btn'); const info=document.getElementById('upload-info');
      const res=document.getElementById('assurance-result'); const badge=document.getElementById('verdict-badge');
      const reasonsUl=document.getElementById('verdict-reasons'); const startBtn=document.getElementById('start-assurance');
      const downloadBtn=document.getElementById('download-assurance'); const checkResultBtn=document.getElementById('check-result');
      let lastAssurance=null;
      
      const stop=(e)=>{e.preventDefault(); e.stopPropagation();};
      const showFiles=(files)=>{const list=Array.from(files).map(f=>`${f.name} ‚Äî ${(f.size/1024).toFixed(1)} –ö–ë`).join('<br>'); info.innerHTML=list||'–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã'; info.hidden=false; startBtn.disabled=false;};
      const send=async(files)=>{const fd=new FormData(); Array.from(files).forEach(f=>fd.append('files[]',f,f.name)); const r=await apiFetch('/assurance',{method:'POST',body:fd}); if(!r.ok) throw 0; return await r.json();}
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
      const showResult=(data)=>{
        lastAssurance=data;
        downloadBtn.disabled=false;
        checkResultBtn.disabled=false;
        badge.textContent=data.title||'‚Äî';
        badge.classList.remove('ok','fail');
        badge.classList.add(data.verdict==='ok'?'ok':'fail');
        reasonsUl.innerHTML='';
        (data.reasons||[]).forEach(t=>{
          const li=document.createElement('li');
          li.textContent=t;
          reasonsUl.appendChild(li);
        });
        res.hidden=false;
      };

      pickBtn.addEventListener('click',()=>input.click());
      input.addEventListener('change',()=>{const files=input.files; if(!files?.length) return; showFiles(files);});
      ['dragenter','dragover','dragleave','drop'].forEach(ev=>dz.addEventListener(ev,stop,false));
      ['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,()=>dz.classList.add('hover'),false));
      ['dragleave','drop'].forEach(ev=>dz.addEventListener(ev,()=>dz.classList.remove('hover'),false));
      dz.addEventListener('drop',(e)=>{const files=e.dataTransfer.files; if(!files?.length) return; input.files=e.dataTransfer.files; showFiles(files);});
      dz.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault(); input.click();}});

      startBtn.addEventListener('click', (event) => {
        window.moduleHandlers.startAssurance(event, {
          //projectID: currentProject().id
          projectID: window.currentProject?.id,
        });
      });

      // –°–∫–∞—á–∞—Ç—å Excel-–æ—Ç—á—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å —á–µ–∫-–ª–∏—Å—Ç–æ–º - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
      downloadBtn.addEventListener('click', (event) => {
        window.moduleHandlers.downloadAssurance(event, {
          //format: 'excel',
          projectID: window.currentProject?.id,
        });
      });

      // –£–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
      checkResultBtn.addEventListener('click', (event) => {
        window.moduleHandlers.checkResult(event, {
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è backend API
          includeDetails: true,
          format: 'detailed'
        });
      });
    })();

    // ===== 2) –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–º–µ—á–∞–Ω–∏–π =====
    (()=>{const zone=document.getElementById('remarks-zone'); const input=document.getElementById('remarks-input');
      const pick=document.getElementById('remarks-pick'); const info=document.getElementById('remarks-info');
      const startBtn=document.getElementById('start-remarks'); const downloadBtn=document.getElementById('download-remarks');
      let lastRemarks=null;

      const stop=(e)=>{e.preventDefault(); e.stopPropagation();};
      const showFiles=(files)=>{const list=Array.from(files).map(f=>`${f.name} ‚Äî ${(f.size/1024).toFixed(1)} –ö–ë`).join('<br>'); info.innerHTML=list||'–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã'; info.hidden=false; startBtn.disabled=false;};
      
      pick.addEventListener('click',()=>input.click());
      input.addEventListener('change',()=>{const files=input.files; if(!files?.length) return; showFiles(files);});
      ['dragenter','dragover','dragleave','drop'].forEach(ev=>zone.addEventListener(ev,stop,false));
      ['dragenter','dragover'].forEach(ev=>zone.addEventListener(ev,()=>zone.classList.add('hover'),false));
      ['dragleave','drop'].forEach(ev=>zone.addEventListener(ev,()=>zone.classList.remove('hover'),false));
      zone.addEventListener('drop',(e)=>{const files=e.dataTransfer.files; if(!files?.length) return; input.files=e.dataTransfer.files; showFiles(files);});
      zone.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault(); input.click();}});

      // –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
      startBtn.addEventListener('click', (event) => {
        window.moduleHandlers.startRemarks(event, {
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è backend API
          projectID: window.currentProject?.id,
        });
      });

      // –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
      downloadBtn.addEventListener('click', (event) => {
        window.moduleHandlers.downloadRemarks(event, {
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è backend API
          projectID: window.currentProject?.id,
        });
      });
    })();

    // ===== 3) –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ =====
    (()=>{
      const btn=document.getElementById('make-protocol');
      const loadingIndicator = document.getElementById('protocol-loading');
      
      btn.addEventListener('click', (event) => {
        window.moduleHandlers.makeProtocol(event, {
          projectID: window.currentProject?.id,
        });
      });
    })();
  });
</script>
</body>
</html>
